<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Preconnect for performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
  <link rel="dns-prefetch" href="//fonts.gstatic.com">

  <!-- Material Icons with font-display optimization -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons&display=swap" rel="stylesheet">
  
  <!-- Roboto Mono for version banner -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ page.title | default: site.title }}</title>

  <!-- SEO Meta Tags -->
  <!-- {% include seo-meta.html %} -->
  {% seo %}

  <!-- Structured Data -->
  {% include structured-data.html %}

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">

  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#1976d2">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="RK Groups">

  <!-- Cache optimization meta tags -->
  <meta http-equiv="Cache-Control" content="max-age=31536000">
  <meta name="cache-control" content="public, max-age=31536000">

  <!-- RSS Feed -->
  <link rel="alternate" type="application/rss+xml" title="{{ site.title }}" href="{{ "/feed.xml" | relative_url }}">

  <!-- Critical CSS - inlined for fastest initial render -->
  <style>
    {% capture critical_css %}{% include critical-css.html %}{% endcapture %}
    {{ critical_css | strip }}
  </style>

  <!-- Preload modular CSS resources -->
  <link rel="preload" href="/assets/css/mui-modular.css" as="style">

  <!-- Non-critical CSS - loaded with low priority for performance -->
  <link rel="preload" href="/assets/css/mui-modular.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="/assets/css/mui-modular.css"></noscript>

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('/sw.min.js')
          .then(function(registration) {
            console.log('SW registered: ', registration);
          })
          .catch(function(registrationError) {
            console.log('SW registration failed: ', registrationError);
          });
      });
    }
  </script>
<!-- Lazy Loading Implementation -->
<script>
// Intersection Observer for lazy loading
const lazyImageObserver = new IntersectionObserver((entries, observer) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            const img = entry.target;
            img.src = img.dataset.src;
            img.classList.remove('lazy');
            observer.unobserve(img);
        }
    });
});

// Initialize lazy loading when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
    const lazyImages = document.querySelectorAll('img.lazy');
    lazyImages.forEach(img => lazyImageObserver.observe(img));
});
</script>
<!-- Optimized CSS Loading -->
<script>
// Load CSS asynchronously
function loadCSS(href, before, media) {
    var doc = window.document;
    var ss = doc.createElement("link");
    var ref;
    if (before) {
        ref = before;
    } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
    }
    var sheets = doc.styleSheets;
    ss.rel = "stylesheet";
    ss.href = href;
    ss.media = "only x";
    function ready(cb) {
        if (doc.body) { return cb(); }
        setTimeout(function() { ready(cb); });
    }
    ready(function() {
        ref.parentNode.insertBefore(ss, (before ? ref : ref.nextSibling));
    });
    var onloadcssdefined = function(cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
            if (sheets[i].href === resolvedHref) {
                return cb();
            }
        }
        setTimeout(function() { onloadcssdefined(cb); });
    };
    function loadCB() {
        if (ss.addEventListener) { ss.removeEventListener("load", loadCB); }
        ss.media = media || "all";
    }
    if (ss.addEventListener) { ss.addEventListener("load", loadCB); }
    ss.onloadcssdefined = onloadcssdefined;
    onloadcssdefined(loadCB);
    return ss;
}

// Load non-critical CSS
loadCSS('/assets/css/mui.min.css');
</script>
</head>
<body class="dark-mode">
  <!-- Skip to main content link for accessibility -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <main id="main-content" role="main">
  <div class="mui-container">
    {{ content }}
  </div>
  </main>

  <!-- Version Banner -->
  {% include version-banner.html %}

  {% include analytics.html %}

  <!-- Performance Monitoring -->
  {% if jekyll.environment == "production" %}
  <script src="{{ '/assets/js/performance-monitoring.min.js' | relative_url }}"></script>
  {% else %}
  <script type="module" src="{{ '/assets/js/performance-monitoring.js' | relative_url }}"></script>
  {% endif %}

  <!-- Error Monitoring & Feedback -->
  {% if jekyll.environment == "production" %}
  <script src="{{ '/assets/js/error-monitoring.min.js' | relative_url }}"></script>
  {% else %}
  <script type="module" src="{{ '/assets/js/error-monitoring.js' | relative_url }}"></script>
  {% endif %}

  <!-- Report Issue Enhancement -->
  {% if jekyll.environment == "production" %}
  <script src="{{ '/report-issue.min.js' | relative_url }}"></script>
  {% else %}
  <script src="{{ '/report-issue.js' | relative_url }}"></script>
  {% endif %}
</body>
</html>


